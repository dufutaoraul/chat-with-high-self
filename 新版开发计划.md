# 🚀 与高我对话 - 全新开发计划

## 📋 **开发策略**

### **方案选择**
✅ **推荐方案**: 在当前项目中重构，保留有用的配置
- 保留 `.env.local`、`package.json`、Supabase配置
- 删除混乱的页面和组件
- 重新创建核心功能

### **您需要配合的步骤**

#### **第一步：备份和清理** (您操作)
1. **备份重要文件**:
   ```bash
   # 创建备份文件夹
   mkdir backup-old-code
   # 备份环境变量
   cp .env.local backup-old-code/
   # 备份package.json
   cp package.json backup-old-code/
   ```

2. **确认环境变量正确**:
   - 检查 `.env.local` 文件是否包含所有必要配置
   - 确认Supabase、Gemini、ZPay配置都正确

#### **第二步：数据库准备** (您操作)
1. **在Supabase中执行新的SQL**:
   - 我会为您生成完整的数据库SQL
   - 在支付数据库 `tarluhsejlzqmwfiwxkb` 中执行

#### **第三步：代码重构** (我操作)
1. **删除无用文件**
2. **创建新的页面结构**
3. **实现核心功能**

## 🎯 **新版功能规划**

### **核心页面**
1. **首页** (`/`) - 保持现有设计
2. **注册/登录** (`/auth`) - 简化版本
3. **个人档案** (`/profile`) - 详细信息填写
4. **聊天界面** (`/chat`) - 主要功能
5. **支付页面** (`/payment`) - 真实支付

### **技术架构**
- ✅ **Next.js 14** - 保持不变
- ✅ **Supabase** - 使用支付数据库
- ✅ **Gemini 2.5** - 支持图片识别
- ✅ **ZPay** - 真实支付
- ✅ **现有域名和部署** - 保持不变

## 💰 **定价确认**

根据您的要求和成本分析：
- 🎁 **免费额度**: 100次对话
- 💎 **基础包**: ¥9.9 = 100次对话
- 🌟 **标准包**: ¥29.9 = 500次对话

**成本分析**:
- Gemini API成本: ~¥0.02/次
- 服务器成本: ~¥0.01/次
- 总成本: ~¥0.03/次
- 基础包利润率: 70%+ ✅
- 标准包利润率: 50%+ ✅

## 🤖 **AI提示词设计**

```
请你扮演我的高我，跟我对话，给我出主意。我叫{姓名}，也请这么称呼我。

用户背景信息：
- 基本信息：{年龄}岁，{职业}，{教育背景}，{家庭状况}
- 性格特点：{性格描述}
- 价值观：{价值观}
- 兴趣爱好：{兴趣爱好}
- 短期目标：{短期目标}
- 长期目标：{长期目标}
- 当前困扰：{当前困扰}
- 期望改变：{期望改变的方面}

跟我聊天的过程中要指出你觉得我可能陷入了哪些思维定式，你看到了哪些我没看到的盲点？你是否能提供我一个完全不同的视角？你可以不顾我的自尊心，你要的是有效，把我往"高"里引导。
```

## 📊 **数据库设计**

### **用户档案表** (扩展版)
```sql
user_profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  email TEXT,
  full_name TEXT,
  age INTEGER,
  occupation TEXT,
  education TEXT,
  family_status TEXT,
  personality TEXT,
  values TEXT,
  interests TEXT,
  short_term_goals TEXT,
  long_term_goals TEXT,
  current_challenges TEXT,
  desired_changes TEXT,
  avatar_url TEXT,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)
```

### **对话计数表** (简化版)
```sql
user_conversations (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  total_conversations INTEGER DEFAULT 0,
  free_conversations_used INTEGER DEFAULT 0,
  paid_conversations INTEGER DEFAULT 0,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)
```

### **聊天记录表**
```sql
chat_messages (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  message TEXT NOT NULL,
  response TEXT,
  image_url TEXT,
  conversation_number INTEGER,
  created_at TIMESTAMP
)
```

### **支付订单表** (基于ZPay)
```sql
zpay_transactions (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  out_trade_no TEXT UNIQUE NOT NULL,
  trade_no TEXT,
  package_type TEXT NOT NULL, -- 'basic_100' or 'standard_500'
  conversations_count INTEGER NOT NULL,
  amount DECIMAL(10,2) NOT NULL,
  status TEXT DEFAULT 'pending',
  payment_method TEXT DEFAULT 'alipay',
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)
```

## 🎨 **设计风格**

### **视觉主题**
- 🌌 **深邃夜空**: 与首页保持一致
- ⭐ **星空动画**: 闪烁、流星效果
- 🎨 **色彩方案**: 深蓝、紫色、金色点缀
- 📱 **响应式**: 完美适配移动端

## ✅ **准备就绪检查**

请确认以下准备工作：
- [ ] 环境变量文件 `.env.local` 正确配置
- [ ] Supabase支付数据库可以访问
- [ ] Gemini API密钥有效
- [ ] ZPay配置正确
- [ ] 同意删除旧的混乱代码
- [ ] 同意在当前项目中重构

## 🚀 **开始信号**

如果您确认以上所有准备工作完成，请回复：
**"开始重构"**

我将立即开始：
1. 清理无用代码
2. 创建新的数据库SQL
3. 重新构建核心功能
4. 实现真实支付
5. 完善用户体验

预计完成时间：**2-3小时内完成MVP版本**
