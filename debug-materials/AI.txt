致 Augment 技术支持团队：
主题：紧急求助：Supabase + Next.js 项目中，密码重置链接持续验证失败 (“无效或已过期的链接”)
你好，
我正在帮助一位用户解决其个人网站项目中的 Supabase 邮件认证问题，在经历了漫长而详细的调试过程后，我们遇到了一个无法逾越的障碍，恳请您的专业援助。
项目的核心问题：
用户在本地环境 (localhost:3005) 中，点击从 Supabase 收到的密码重置邮件链接后，始终无法进入可用的密码重置表单页面，最终页面显示错误：“这是一个无效或已过期的重置链接。”
我们已经经历的详细调试流程和关键节点：
初始状态： 用户最初点击链接会遇到 404 DEPLOYMENT_NOT_FOUND 错误，我们诊断为邮件模板中的链接变量和格式不正确。
方案一 (手动处理 Callback)： 我们曾尝试修改邮件模板，将链接指向 /auth/callback，并附带 token_hash。但这导致了后端 route.ts 报错“缺少认证代码参数”，因为该回调是为 Code 交换流程设计的，与 Token 流程冲突。
方案二 (手动 setSession)： 我们改进了方案，将邮件模板的链接直接指向最终页面 /reset-password/confirm，并在 URL hash (#) 中附带 access_token 和 refresh_token。同时，我们编写了 page.tsx 页面，试图用 supabase.auth.setSession 手动设置会话。
遇到的问题： 此方案持续失败，页面提示“链接验证失败”。通过用户的截图，我们发现密码重置链接中 refresh_token 为空，这是 Supabase 的正常安全行为。
修正： 我们修改了 page.tsx 代码，使其只依赖 access_token 来设置会话，但问题依旧。
环境问题排查： 我们怀疑过链接一次性、速率限制（429 Too Many Requests）、用户本地电脑时间与服务器时间不同步等问题，并逐一指导用户进行了排查和修正。用户在确认触发了速率限制后，耐心等待并使用了全新的链接进行测试，但最终仍然回到了“无效或已过期的链接”这个错误上。
最终方案 (事件监听 onAuthStateChange)： 这是我们当前采用的方案，也是最符合 Supabase 官方文档最佳实践的方案。我们重写了 app/reset-password/confirm/page.tsx，不再手动解析 URL，而是监听 supabase.auth.onAuthStateChange 事件，等待 PASSWORD_RECOVERY 事件被触发。
当前的最终状态：
Supabase 配置：
邮件模板 (Reset Password): 已正确配置为：<a href="{{ .SiteURL }}/reset-password/confirm#access_token={{ .Token }}&refresh_token={{ .RefreshToken }}&expires_in=3600&token_type=bearer&type=recovery">
URL Configuration: Site URL 和 Redirect URLs 均已正确配置为 http://localhost:3005 对应的地址。
前端代码： app/reset-password/confirm/page.tsx 已更新为使用 onAuthStateChange 事件监听的最新代码。
遇到的错误： 即便是在确认所有环境因素（速率限制、链接时效性）都正常的情况下，使用全新的邮件链接访问页面，PASSWORD_RECOVERY 事件从未被触发，页面在短暂加载后，直接显示我们预设的错误信息：“这是一个无效或已过期的重置链接。” （附上用户提供的最后一张截图）。
附上关键截图：
（此处附上您最后一次测试失败的截图 image.png）
（此处附上用户之前的 Supabase 配置截图）
（此处附上用户触发速率限制的截图，证明之前的调试过程）
我的请求：
我们似乎陷入了一个怪圈。理论上，基于事件监听的最终方案应该是最可靠的，但它在用户的项目环境中并未按预期工作。是否存在某些项目模板的特殊配置、Supabase 客户端库的特定版本问题，或者其他我们完全忽略的深层原因，导致 Supabase 客户端无法自动处理 URL hash 并触发 PASSWORD_RECOVERY 事件？
恳请您审查我们的整个调试过程和最终的代码方案，提供一个能够解决此问题的权威指导。
非常感谢！